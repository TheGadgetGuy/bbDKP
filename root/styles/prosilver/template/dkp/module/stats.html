<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="{T_TEMPLATE_PATH}/dkp/flot/excanvas.min.js"></script><![endif]-->
<script src="{T_TEMPLATE_PATH}/dkp/flot/jquery.flot.js" language="javascript" type="text/javascript"></script> 
<script src="{T_TEMPLATE_PATH}/dkp/flot/jquery.flot.valuelabels.js" language="javascript" type="text/javascript"></script> 
<script src="{T_TEMPLATE_PATH}/dkp/flot/jquery.flot.pie.min.js" language="javascript" type="text/javascript"></script> 
<!-- Credits : the Stats page uses Flot from http://code.google.com/p/flot/ -->
<style  type="text/css">
/* css for flot */
.valueLabels {
	font-size:70%;
	color:black;
}

div.valueLabelLight {
	opacity:0.5;
	background-color: white;
	border:none;
	position:absolute;
}

div.valueLabel {
	position:absolute;
	border:none;
}

div.tickLabel { 
	padding-left:20px !important;
	font-size: 11px !important;
    font-style: italic !important;
    /*font-weight: bold !important;*/
    font-family: sans-serif !important;
    font-variant: small-caps !important;
}

div.graph {
	float: left;
	align: center;
}


</style>

<form method="post" action="{F_STATS}">

<div class="forabg" >
<span class="corners-top"><span></span></span>
<ul class="topiclist">
<li class="header">
<table width="30%" border="0" cellspacing="1" cellpadding="2" style="border-bottom: none">
<colgroup  span="2">
<col width="10%"></col>
<col width="10%"></col>
<col width="90%"></col>
</colgroup>
<tr>
<td><h1 style="color:#dfc065">{L_MENU_STATS}</h1>	</td>
<td></td>
<td style="color:white; text-align:left; width:56 white-space:nowrap;">{L_POOL}:
      <select name="pool" class="input" onchange="javascript:form.submit();">
        <!-- BEGIN pool_row -->
        <option value="{pool_row.VALUE}" {pool_row.SELECTED}{pool_row.DISABLED}>{pool_row.OPTION}</option>
        <!-- END pool_row -->
      </select>
  </td>
</tr>
</table>
</li>
</ul>
<span class="corners-bottom"><span></span></span>
</div>
</form> 

<!--  Member statistics -->
<h3>{L_MEMBERS}</h3>

<div class="panel">
<div class="inner">
<span class="corners-top"><span></span></span>


<div class="forabg" style="width:35%; float:left;">
<div class="inner">
<span class="corners-inner-top"><span></span></span>

<table class="table1" width="100%" border="0" cellspacing="0" cellpadding="0">
<thead>
<tr>	  
    <th style=" width:20%;"><a href="{O_NAME}">{L_NAME}</a></th>
    <!-- IF S_SHOWEPGP -->
    <th style=" width:20%; text-align:center;" ><a href="{O_PR}">{L_PR}</a></th>
    <!-- ELSE -->
    <th style=" width:20%; text-align:center;" ><a href="{O_CURRENT}">{L_CURRENT}</a></th>
	<!-- ENDIF -->    
    <th style=" width:20%; text-align:center;" ><a href="{O_RAIDCOUNT}">{L_RAIDCOUNT}</a></th>
    <th colspan="2" style=" width:40%; text-align:center;" ><a href="{O_ITEMCOUNT}">{L_LOOTS}</a></th>
</tr>
</thead>
<tfoot>
<tr>
<th align="left" style="color:white; font-weight:bold; width:40%;" colspan="3">{STATS_FOOTCOUNT}</th>
<th align="left" style="color:white; font-weight:bold; width:20%;">{TOTAL_RAIDS}</th>
<th align="left" style="color:white; font-weight:bold; width:40%;" colspan="2">{TOTAL_DROPS}</th>
</tr>
</tfoot>
<tbody>
<!-- BEGIN stats_row -->
    <!-- IF stats_row.S_ROW_COUNT is odd -->
    <tr class= "bg1">
    <!-- ELSE -->
    <tr class= "bg2">
    <!-- ENDIF -->
    <td><a style="color:{stats_row.COLORCODE}" href="{stats_row.U_VIEW_MEMBER}"><strong>{stats_row.NAME}</strong></a></td>
    <!-- IF S_SHOWEPGP -->
    <td style="font-size :8pt; text-align: center;"><strong>{stats_row.PR}</strong></td>
    <!-- ELSE -->
    <td style="font-size :8pt; text-align: center;"><span class="{stats_row.C_CURRENT}"><strong>{stats_row.CURRENT}</strong></span></td>
    <!-- ENDIF -->  
    <td style="font-size :8pt; text-align: center;">{stats_row.ATTENDED_COUNT}</td>
    <td style="font-size :8pt; text-align: center;">{stats_row.ITEM_COUNT}</td>
	<td style="font-size :8pt; text-align: center;">{stats_row.MEMBER_DROP_PCT}</td>    
    
    
  </tr>
<!-- END stats_row -->
</tbody>
</table>

<span class="corners-inner-bottom"><span></span></span>
</div>
</div>

<div style="width:60%; float:left;">
<div id="memberstats" class="graph"></div>
<script type="text/javascript">
$(function () {
	 var plotarea = $("#memberstats");  
	plotarea.css("height", "250px");  
	plotarea.css("width", "100%");
	 
	var memberdkp = [<!-- BEGIN stats_row -->[{stats_row.COUNT},<!-- IF S_SHOWEPGP -->{stats_row.PR}<!-- ELSE -->{stats_row.CURRENT}<!-- ENDIF -->]<!-- IF ! stats_row.S_LAST_ROW -->,<!-- ENDIF --><!-- END stats_row -->];
	var attendance = [<!-- BEGIN stats_row -->[{stats_row.COUNT},{stats_row.ATTENDED_COUNT}]<!-- IF ! stats_row.S_LAST_ROW -->,<!-- ENDIF --><!-- END stats_row -->];
	var members = [<!-- BEGIN stats_row -->[{stats_row.COUNT},"{stats_row.NAME}"]<!-- IF ! stats_row.S_LAST_ROW -->, <!-- ENDIF --> <!-- END stats_row -->];  
	var dkpoptions = { xaxis: {ticks: members, autoscaleMargin: 0.05},
			colors: ["#FFDD00", "#AAFF66", "#FF3366"],
			yaxes: [{ position: 'left'},
                    { position: 'right'}]
			};
	var plot = $.plot( plotarea , [
              {
                  data: memberdkp,
                  bars: { show: true, barWidth: 70/100, fill: 0.30 },
                  yaxis:1
                  
              },
              {
                  data: attendance,
                  lines: { show: true, fill: false },
                  yaxis:2
              }], 
		dkpoptions ); 
	
});
</script>
</div>

<span class="corners-bottom"><span></span></span>
</div>
</div>

<div style="clear:both;"></div>
<hr />
<!--  Class statistics -->

<h3>{L_LOOTDIST_CLASS}</h3>

<div class="panel">
<div class="inner">
<span class="corners-top"><span></span></span>


<div class="forabg" style="width:50%; float:left;">
<div class="inner">

<span class="corners-inner-top"><span></span></span>
<table class="table1" width="100%" border="0" cellspacing="1" cellpadding="0">
<thead>
<tr>
<th style="color:white; font-size :9pt; text-align: left;">{L_CLASS}</th>
<th colspan="2" style="color:white; font-size :9pt; text-align: center;"># {L_MEMBERS}</th>

<th style="color:white; font-size :9pt; text-align: center;"># {L_LOOTS}</th>
<th style="color:white; font-size :9pt; text-align: center; text-align: center;">% {L_LOOTS}</th>
<th style="color:white; font-size :9pt; text-align: center;"></th>

</tr>
</thead>
<tfoot>

<tr>
<th style="color:white; font-size :9pt; text-align: left;"></th>
<th colspan="2" style="color:white; font-size :9pt; text-align: center;">{TOTAL_MEMBERS}</th>

<th style="color:white; font-size :9pt; text-align: center;">{TOTAL_DROPS}</th>
<th style="color:white; font-size :9pt; text-align: center; text-align: center;"></th>
<th style="color:white; font-size :9pt; text-align: center;">{CLASSPCTCUMUL}</th>

</tr>
</tfoot>
<tbody>
<!-- BEGIN class_row -->  
   <!-- IF class_row.S_ROW_COUNT is even -->
   <tr class="bg1">
   <!-- ELSE -->
   <tr class="bg2">
   <!-- ENDIF -->
	  <td style="width:20%; white-space: nowrap;"><!-- IF class_row.S_CLASS_IMAGE_EXISTS --><img src="{class_row.CLASS_IMAGE}" alt="abc" /><!-- ELSE -->&nbsp;<!-- ENDIF -->
	  &nbsp;<a style="white-space: nowrap; color:{class_row.COLORCODE}" href="{class_row.U_LIST_MEMBERS}"><strong>{class_row.CLASS_NAME}</strong></a> </td>
	  <td style="width:7.5%; text-align:center;">{class_row.CLASS_COUNT}</td>
	  <td style="width:7.5%; text-align:center;">{class_row.CLASS_PCT}</td>
	  <td style="width:7.5%; text-align:center;">{class_row.LOOT_COUNT}</td>
	  <td style="width:7.5%; text-align:center;">{class_row.CLASS_DROP_PCT_STR}</td>
	  <td style="width:7.5%; text-align:center;"><span class= "{class_row.C_LOOT_FACTOR}">{class_row.LOOTOVERRUN}</span></td>
  </tr>
  
<!-- END class_row -->
</tbody>
</table>

<span class="corners-inner-bottom"><span></span></span>
</div>
</div>

<div class="panel" style="width:45%; float:left;">
<div class="inner">
<span class="corners-inner-top"><span></span></span>

<div>
<div class="inner">
<span class="corners-top"><span></span></span>
<h4>% {L_MEMBERS}</h4>
<div id="classdropgraphs" class="graph"></div>
<span class="corners-inner-bottom"><span></span></span>
</div>
</div>

<div>
<div class="inner">
<span class="corners-top"><span></span></span>
<h4>% {L_LOOTS}</h4>
<div id="classdropgraphs2" class="graph"></div>
<span class="corners-inner-bottom"><span></span></span>
</div>
</div>

<script type="text/javascript">
$(function () {
	var plotarea = $("#classdropgraphs");  
	plotarea.css("height", "200px");  
	plotarea.css("width", "100%");
	var plotarea2 = $("#classdropgraphs2");  
	plotarea2.css("height", "200px");  
	plotarea2.css("width", "100%");

	var classpct = [<!-- BEGIN class_row --> {label: "{class_row.CLASS_NAME}", data : {class_row.CLASS_PCT}, color:"{class_row.COLORCODE}" }, <!-- END class_row -->];
	var plot = $.plot( plotarea ,
	classpct, 
	{
		series: {
				pie: {
						show: true,
						combine: {
		                    color: '#999',
		                    threshold: 0.05
		                },
						radius: 1,
						label: {
		                    show: true,
		                    radius: 3/4,
		                    formatter: function(label, series){
		                        return '<div style="font-size:8pt;text-align:center;padding:2px;color:white;">'+label+'<br/>'+Math.round(series.percent)+'%</div>';
		                    },
		                    background: { 
			                    opacity: 0.5,
		                    	color: '#000' },
		                    threshold: 0.1
		                    
		                }
				}
		},
	 	legend: {
            show: false
        }
	});
	
	var classdroppct = [<!-- BEGIN class_row --> {label: "{class_row.CLASS_NAME}" , data : {class_row.CLASS_DROP_PCT}, color : "{class_row.COLORCODE}" } <!-- IF ! class_row.S_LAST_ROW -->, <!-- ENDIF --> <!-- END class_row -->];
	var plot = $.plot( plotarea2 ,
	classdroppct, 
	{
		series: {
				pie: {
						show: true,
						combine: {
		                    color: '#999',
		                    threshold: 0.05
		                },
						radius: 1,
						label: {
		                    show: true,
		                    radius: 3/4,
		                    formatter: function(label, series){
		                        return '<div style="font-size:8pt;text-align:center;padding:2px;color:white;">'+label+'<br/>'+Math.round(series.percent)+'%</div>';
		                    },
		                    background: { 
			                    opacity: 0.5,
		                    	color: '#000' },
		                    threshold: 0.1
		                    
		                }
				}
		},
	 	legend: {
            show: false
        }
	});
	
});
</script>



<span class="corners--inner-bottom"><span></span></span>
</div>
</div>


<span class="corners-bottom"><span></span></span>
</div>
</div>

<div style="clear:both;"></div>
<hr />

<!--  Attendance statistics -->
<h3>{L_RAID_ATTENDANCE_HISTORY}</h3>

<div class="panel">
<div class="inner">
<span class="corners-top"><span></span></span>

<div class="forabg" style="width:45%; float:left;">
<div class="inner">
<span class="corners-inner-top"><span></span></span>


<table class="table1" width="90%" border="0" cellspacing="0" cellpadding="0">
<thead>
<tr>	  
    <th colspan="3" style=" width:8%;"><a href="{O_NAME}">{L_NAME}</a></th>
    <th colspan="3" style=" width:23%;"><a href="{O_NAME}">{L_ATTENDANCE_LIFETIME}</a></th>
    <th colspan="3" style=" width:23%;">{RAIDS_X1_DAYS}</th>
    <th colspan="3" style=" width:23%;">{RAIDS_X2_DAYS}</th>
    <th colspan="3" style=" width:23%;">{RAIDS_X3_DAYS}</th>
</tr>
</thead>
<tfoot>
<tr>
<th align="left" style="color:white; font-weight:bold;" colspan="15">{STATS_FOOTCOUNT}</th>
</tr>
</tfoot>
<tbody>
<!-- BEGIN attendance_row -->
    <!-- IF attendance_row.S_ROW_COUNT is odd -->
    <tr class= "bg1">
    <!-- ELSE -->
    <tr class= "bg2">
    <!-- ENDIF -->
    <td><a style="color:{attendance_row.COLORCODE}" href="{attendance_row.U_VIEW_MEMBER}"><strong>{attendance_row.NAME}</strong></a></td>
    <td style="font-size :8pt; text-align: right;"><strong>{stats_row.FIRSTRAID}</strong></td>
    <td style="font-size :8pt; text-align: right;"><strong>{stats_row.LASTRAID}</strong></td>
    
    <td style="font-size :8pt; text-align: center;">{attendance_row.GRCTLIFE}</td>
    <td style="font-size :8pt; text-align: center;">{attendance_row.IRCTLIFE}</td>
	<td style="font-size :8pt; text-align: center;">{attendance_row.ATTLIFESTR}</td>    

    <td style="font-size :8pt; text-align: center;">{attendance_row.GRCT90}</td>
    <td style="font-size :8pt; text-align: center;">{attendance_row.IRCT90}</td>
	<td style="font-size :8pt; text-align: center;">{attendance_row.ATT90STR}</td>    

    <td style="font-size :8pt; text-align: center;">{attendance_row.GRCT60}</td>
    <td style="font-size :8pt; text-align: center;">{attendance_row.IRCT60}</td>
	<td style="font-size :8pt; text-align: center;">{attendance_row.ATT60STR}</td>   
	
    <td style="font-size :8pt; text-align: center;">{attendance_row.GRCT30}</td>
    <td style="font-size :8pt; text-align: center;">{attendance_row.IRCT30}</td>
	<td style="font-size :8pt; text-align: center;">{attendance_row.ATT30STR}</td>       
    
  </tr>
<!-- END attendance_row -->
</tbody>

</table>

<span class="corners-inner-bottom"><span></span></span>
</div>
</div>

<div class="panel" style="width:50%; float:left;">
<div class="inner">
<span class="corners-top"><span></span></span>

<div style="width:100%; float:left;">
<div id="attendanceplot" class="graph"></div>

<p id="choices">Show:</p>

<script type="text/javascript">
$(function () {
	var canvas_attendance = $("#attendanceplot");  
	canvas_attendance.css("height", "700px");  
	canvas_attendance.css("width", "90%");
	var attnames = [[1, "{L_ATTENDANCE_LIFETIME}"], [2,"{RAIDS_X1_DAYS}"], [3,"{RAIDS_X2_DAYS}"], [4,"{RAIDS_X3_DAYS}"]];

	var coreraider = 60;
	var raidsupport = 40;
	var social = 20;

	var coreraiderlbl = "Core Raider";
	var raidsupportlbl = "Can Sign up but does not get priority";
	var sociallbl = "Can not sign up anymore";
	
    var markings = [
        { color: '#DDFFDD', yaxis: { from: coreraider } },
        { color: '#FFFFFF', yaxis: { from: social , to: coreraider } },
        { color: '#FFDDDD', yaxis: { to: social } },
    ];
    
	var attoptions = { 
		xaxis: {
			ticks: attnames, autoscaleMargin: 0.05, 
		} , 
		yaxis: { min: 0 , max: 100},
		legend: { 
			position: 'sw' 
		},
		grid: { markings: markings 
			},
		lines: { show: true, fill: false },
		points: { show: true } ,
		
	};
	<!-- BEGIN attendance_row -->
	var member{attendance_row.ID} = [[1,{attendance_row.ATTLIFE}],[2,{attendance_row.ATT90}],[3,{attendance_row.ATT60}],[4,{attendance_row.ATT30}]];<!-- END attendance_row -->

	    
	var dataset = {
	<!-- BEGIN attendance_row -->
	"member{attendance_row.ID}" :	{data: [[1,{attendance_row.ATTLIFE}],[2,{attendance_row.ATT90}],[3,{attendance_row.ATT60}],[4,{attendance_row.ATT30}]],
		label: "{attendance_row.NAME}",
		color: "{attendance_row.COLORCODE}"  
		}<!-- IF ! attendance_row.S_LAST_ROW -->, 
	<!-- ENDIF -->
	 <!-- END attendance_row -->
			};

	// loop datasets, add html 
	var choiceContainer = $("#choices");
	 $.each(datasets, function(key, val) {
	        choiceContainer.append('<br/><input type="checkbox" name="' + key +
	                               '" checked="checked" id="id' + key + '">' +
	                               '<label for="id' + key + '">'
	                                + val.label + '</label>');
	  });
	choiceContainer.find("input").click(plotAccordingToChoices);

	 // insert checkboxes 
	function plotAccordingToChoices() {
	        var data = [];

	        choiceContainer.find("input:checked").each(function () {
	            var key = $(this).attr("name");
	            if (key && datasets[key])
	                data.push(datasets[key]);
	        });

	        if (data.length > 0)
			{
	            $.plot(canvas_attendance, data, attoptions);
			}
	    }
	 plotAccordingToChoices();
	    
    /*
	var plot = $.plot(canvas_attendance, 
	[<!-- BEGIN attendance_row -->{
			data: member{attendance_row.ID} ,
			color: "{attendance_row.COLORCODE}" , 
			label: "{attendance_row.NAME}", 
			 }<!-- IF ! attendance_row.S_LAST_ROW -->, 
	<!-- ENDIF --><!-- END attendance_row -->], 
		attoptions); 
	*/



	
	// add labels
    var o;

    
    o = plot.pointOffset({ x: 2, y: social - 5});
    canvas_attendance.append('<div style="position:absolute;left:' + (o.left + 4) + 'px;top:' + o.top + 'px;color:#666;font-size:smaller">' + sociallbl + '</div>');
 
    o = plot.pointOffset({ x: 2, y: raidsupport - 5});
    canvas_attendance.append('<div style="position:absolute;left:' + (o.left + 4) + 'px;top:' + o.top + 'px;color:#666;font-size:smaller">' + raidsupportlbl + '</div>');

    o = plot.pointOffset({ x: 2, y: coreraider + 10});
    canvas_attendance.append('<div style="position:absolute;left:' + (o.left + 4) + 'px;top:' + o.top + 'px;color:#666;font-size:smaller">' + coreraiderlbl + ' </div>');
    
    var choiceContainer = $("#choices");


    
    
});
</script>
</div>

<span class="corners-bottom"><span></span></span>
</div>
</div>


<span class="corners-bottom"><span></span></span>
</div>
</div>

